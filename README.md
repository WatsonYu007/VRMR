本指南适用于那些过去构建应用程序的基础知识的开发人员，现在想知道构建强大的生产质量应用程序的最佳实践和建议的体系结构。
>注意：本指南假定读者熟悉Android框架。如果您不熟悉应用程序开发，请查看入门培训系列，其中包含本指南的必备主题。

###应用开发者面临的常见问题
与传统的桌面应用程序不同，Android应用程序的结构要复杂得多，在大多数情况下，它们只有一个启动快捷方式的入口点，并且可以作为一个单一的整体进程运行。一个典型的Android应用程序是由多个应用程序组件构成的，包括活动，片段，服务，内容提供者和广播接收器。


大多数这些应用程序组件都是在Android操作系统使用的应用程序清单中声明的​​，以决定如何将您的应用程序与其设备的整体用户体验相集成。虽然如前所述，桌面应用程序传统上是以整体的方式运行的，但正确编写的Android应用程序需要更加灵活，因为用户可以通过设备上的不同应用程序进行编程，不断切换流程和任务。


例如，请考虑在您最喜爱的社交网络应用程序中分享照片时会发生什么情况。该应用程序触发Android操作系统启动相机应用程序来处理请求的相机意图。此时，用户离开了社交网络应用，但他们的体验是无缝的。相机应用程序又可能触发其他意图，例如启动文件选择器，该文件选择器可以启动另一个应用程序。最终用户回到社交网络应用程序并分享照片。此外，用户在这个过程的任何时候都可能被电话打断，并在打完电话后回来分享照片。


在Android中，这种应用程序跳转行为很常见，所以您的应用程序必须正确处理这些流程。请记住，移动设备是资源受限，所以在任何时候，操作系统可能需要杀死一些应用程序，以腾出空间给新的。所有这一切的关键是，您的应用程序组件可以单独和无序地启动，并可以在任何时候由用户或系统销毁。由于应用程序组件是短暂的，它们的生命周期（创建和销毁时）不在您的控制之下，因此您不应该在应用程序组件中存储任何应用程序数据或状态，并且应用程序组件不应相互依赖。


###常见的架构原则

如果您不能使用应用程序组件来存储应用程序数据和状态，应该如何构建应用程序？

你应该关注的最重要的事情是在你的应用程序中分离关注点。将所有代码写入Activity或Fragment是一个常见的错误。任何不处理UI或操作系统交互的代码都不应该在这些类中。尽可能保持精简可以避免许多生命周期相关的问题。不要忘记，你不拥有这些类，它们只是体现操作系统和你的应用程序之间的契约的胶水类。 Android操作系统可能会随时根据用户交互或其他因素（如低内存）来销毁它们。最好最大限度地减少对他们的依赖，以提供可靠的用户体验。

第二个重要的原则是你应该从一个模型驱动你的UI，最好是一个持久模型。持久性是理想的，原因有两个：如果操作系统破坏您的应用程序以释放资源，则您的用户不会丢失数据，即使网络连接不稳定或连接不上，您的应用程序也将继续工作。模型是负责处理应用程序数据的组件。它们独立于应用程序中的视图和应用程序组件，因此它们与这些组件的生命周期问题是隔离的。保持简单的UI代码和免费的应用程序逻辑，使管理更容易。将您的应用程序放在具有明确定义的管理数据责任的模型类上，将使它们可测试，并使您的应用程序保持一致。


###推荐的应用架构

在本节中，我们将演示如何通过使用用例来构建使用体系结构组件的应用程序。

>注意：不可能有一种编写应用程序的方法，这对每种情况都是最好的。这就是说，这个推荐的架构应该是大多数用例的一个很好的起点。如果您已经有了编写Android应用的好方法，则不需要更改。想象一下，我们正在构建一个显示用户配置文件的用户界面。该用户配置文件将使用REST API从我们自己的私人后端获取。

想象一下，我们正在构建一个显示用户配置文件的用户界面。该用户配置文件将使用REST API从我们自己的私人后端获取。


####构建用户界面
用户界面将由fragment  UserProfileFragment.java 和 布局文件user_profile_layout.xml组成。

为了驱动用户界面，我们的数据模型需要保存两个数据元素。

*User ID:用户的标识符。最好使用片段参数将此信息传递到片段中。如果Android操作系统破坏您的进程，这些信息将被保留，以便在您的应用下次重新启动时可用。

*User对象：持有用户数据的POJO

我们将创建一个基于ViewModel类的UserProfileViewModel来保存这些信息。

>ViewModel为特定的UI组件（如片段或活动）提供数据，并处理与数据处理业务部分的通信，例如调用其他组件来加载数据或转发用户修改。 ViewModel不知道视图，并且不受配置更改的影响，例如由于旋转而重新创建活动。

现在我们有3个文件:

*user_profile.xml

*UserProfileViewModel.java

*UserProfileFragment.java

